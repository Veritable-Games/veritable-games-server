<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stellar Dodecahedron Viewer</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #000;
        font-family: Arial, sans-serif;
        overflow: hidden;
      }

      #canvas-container {
        position: relative;
        width: 100vw;
        height: 100vh;
      }

      /* Celestial body hover UI */
      #white-dwarf-ui,
      .celestial-body-ui {
        position: absolute;
        pointer-events: none;
        z-index: 90;
        opacity: 0;
        transform: scale(0.8);
        transition:
          opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      #white-dwarf-ui.visible,
      .celestial-body-ui.visible {
        opacity: 1;
        transform: scale(1);
      }

      .star-circle {
        width: 80px;
        height: 80px;
        border: 2px solid #b4ccff;
        border-radius: 50%;
        position: relative;
        animation: pulse-glow 2s ease-in-out infinite;
      }

      .star-circle::before {
        content: '';
        position: absolute;
        width: calc(100% + 8px);
        height: calc(100% + 8px);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid rgba(180, 204, 255, 0.4);
        border-radius: 50%;
      }

      .star-info {
        position: absolute;
        top: 90px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: #b4ccff;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 12px;
        white-space: nowrap;
        border: 1px solid rgba(180, 204, 255, 0.3);
      }

      @keyframes pulse-glow {
        0%,
        100% {
          border-color: #b4ccff;
        }
        50% {
          border-color: #ffffff;
        }
      }

      /* Planet Chione specific styles */
      .planet-circle {
        width: 90px;
        height: 90px;
        border: 2px solid #4a9edb;
        border-radius: 50%;
        position: relative;
        animation: planet-pulse 3s ease-in-out infinite;
      }

      .planet-circle::before {
        content: '';
        position: absolute;
        width: calc(100% + 10px);
        height: calc(100% + 10px);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid rgba(74, 158, 219, 0.4);
        border-radius: 50%;
      }

      @keyframes planet-pulse {
        0%,
        100% {
          border-color: #4a9edb;
        }
        50% {
          border-color: #6bb6ff;
        }
      }

      /* Moon Grand Voss specific styles */
      .moon-circle {
        width: 60px;
        height: 60px;
        border: 2px solid #c0c0c0;
        border-radius: 50%;
        position: relative;
        animation: moon-pulse 2.5s ease-in-out infinite;
      }

      .moon-circle::before {
        content: '';
        position: absolute;
        width: calc(100% + 6px);
        height: calc(100% + 6px);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid rgba(192, 192, 192, 0.4);
        border-radius: 50%;
      }

      @keyframes moon-pulse {
        0%,
        100% {
          border-color: #c0c0c0;
        }
        50% {
          border-color: #e0e0e0;
        }
      }

      /* Help Button - Subtle Bottom Right Corner */
      #help-button {
        position: fixed;
        bottom: 16px;
        right: 16px;
        width: 24px;
        height: 24px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        opacity: 0.35;
        z-index: 100;
        transition: opacity 0.2s ease;
      }

      #help-button:hover {
        opacity: 0.7;
      }

      #help-button svg {
        width: 100%;
        height: 100%;
        display: block;
        stroke: white;
        stroke-width: 1.5;
        fill: none;
      }

      /* Controls Overlay - Subtle */
      #controls-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 200;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
      }

      #controls-overlay.visible {
        opacity: 1;
        pointer-events: auto;
      }

      #controls-panel {
        background: rgba(0, 0, 0, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 24px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        transform: scale(0.95);
        transition: transform 0.2s ease;
      }

      #controls-overlay.visible #controls-panel {
        transform: scale(1);
      }

      #controls-panel h2 {
        margin: 0 0 16px 0;
        color: rgba(255, 255, 255, 0.9);
        font-size: 18px;
        font-weight: 500;
        text-align: center;
      }

      .control-section {
        margin-bottom: 16px;
      }

      .control-section:last-child {
        margin-bottom: 0;
      }

      .control-section h3 {
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        font-weight: 500;
        margin: 0 0 8px 0;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .control-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
        color: rgba(255, 255, 255, 0.5);
        font-size: 12px;
      }

      .control-action {
        color: rgba(255, 255, 255, 0.7);
        font-weight: 400;
      }

      .control-keys {
        display: flex;
        gap: 4px;
      }

      .key {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 3px;
        padding: 3px 6px;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        min-width: 24px;
        text-align: center;
      }

      #close-controls {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 24px;
        height: 24px;
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.4);
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s ease;
        padding: 0;
        line-height: 1;
      }

      #close-controls:hover {
        color: rgba(255, 255, 255, 0.8);
      }

      /* Mobile adjustments */
      @media (max-width: 640px) {
        #controls-panel {
          padding: 24px;
          max-height: 80vh;
          overflow-y: auto;
        }

        #controls-panel h2 {
          font-size: 24px;
        }

        .control-section h3 {
          font-size: 14px;
        }

        .control-item {
          font-size: 13px;
          flex-direction: column;
          align-items: flex-start;
          gap: 4px;
        }
      }
    </style>
  </head>
  <body>
    <div id="canvas-container">
      <!-- Gies (White Dwarf) hover UI -->
      <div id="white-dwarf-ui">
        <div class="star-circle"></div>
        <div class="star-info">
          Gies (DA White Dwarf)<br />
          T: ~25,000K | M: 0.6 M☉
        </div>
      </div>

      <!-- Chione (Planet) hover UI -->
      <div id="chione-ui" class="celestial-body-ui">
        <div class="planet-circle"></div>
        <div class="star-info">
          Chione (Super-Earth)<br />
          Period: 2.8 years | M: 5 M⊕
        </div>
      </div>

      <!-- Grand Voss (Moon) hover UI -->
      <div id="grand-voss-ui" class="celestial-body-ui">
        <div class="moon-circle"></div>
        <div class="star-info">
          Grand Voss (Moon)<br />
          Period: 14 days | M: 1.2 M☾
        </div>
      </div>
    </div>

    <!-- Help Button -->
    <button id="help-button" aria-label="Show controls">
      <!-- Heroicons information-circle outline (MIT License) -->
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"
        />
      </svg>
    </button>

    <!-- Controls Overlay -->
    <div id="controls-overlay" role="dialog" aria-labelledby="controls-title" aria-modal="true">
      <div id="controls-panel">
        <button id="close-controls" aria-label="Close controls">×</button>
        <h2 id="controls-title">Controls</h2>

        <div class="control-section">
          <h3>Camera</h3>
          <div class="control-item">
            <span class="control-action">Orbit camera</span>
            <div class="control-keys">
              <span class="key">Right-drag</span>
              <span class="key">1-finger drag</span>
            </div>
          </div>
          <div class="control-item">
            <span class="control-action">Zoom in/out</span>
            <div class="control-keys">
              <span class="key">Wheel</span>
              <span class="key">2-finger pinch</span>
            </div>
          </div>
          <div class="control-item">
            <span class="control-action">Reset view</span>
            <div class="control-keys">
              <span class="key">R</span>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>Objects</h3>
          <div class="control-item">
            <span class="control-action">Show info</span>
            <div class="control-keys">
              <span class="key">Hover</span>
            </div>
          </div>
          <div class="control-item">
            <span class="control-action">Track/return</span>
            <div class="control-keys">
              <span class="key">Double-click</span>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>Dodecahedron</h3>
          <div class="control-item">
            <span class="control-action">Rotate X/Y</span>
            <div class="control-keys">
              <span class="key">W</span>
              <span class="key">A</span>
              <span class="key">S</span>
              <span class="key">D</span>
            </div>
          </div>
          <div class="control-item">
            <span class="control-action">Rotate Z</span>
            <div class="control-keys">
              <span class="key">Q</span>
              <span class="key">E</span>
            </div>
          </div>
          <div class="control-item">
            <span class="control-action">Fit to screen</span>
            <div class="control-keys">
              <span class="key">F</span>
              <span class="key">Space</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Import map for Three.js -->
    <script type="importmap">
      {
        "imports": {
          "three": "./three.js/three.module.js",
          "three/addons/": "./three.js/examples/jsm/"
        }
      }
    </script>

    <!-- Controls Toggle Script -->
    <script>
      // Controls overlay toggle functionality
      (function () {
        const helpButton = document.getElementById('help-button');
        const controlsOverlay = document.getElementById('controls-overlay');
        const closeButton = document.getElementById('close-controls');

        function showControls() {
          controlsOverlay.classList.add('visible');
          // Focus the close button for keyboard accessibility
          closeButton.focus();
        }

        function hideControls() {
          controlsOverlay.classList.remove('visible');
          // Return focus to help button
          helpButton.focus();
        }

        // Help button click
        helpButton.addEventListener('click', showControls);

        // Close button click
        closeButton.addEventListener('click', hideControls);

        // Click outside panel to close
        controlsOverlay.addEventListener('click', e => {
          if (e.target === controlsOverlay) {
            hideControls();
          }
        });

        // Escape key to close
        document.addEventListener('keydown', e => {
          if (e.key === 'Escape' && controlsOverlay.classList.contains('visible')) {
            e.preventDefault();
            hideControls();
          }
        });

        // Trap focus inside modal when open
        controlsOverlay.addEventListener('keydown', e => {
          if (e.key === 'Tab' && controlsOverlay.classList.contains('visible')) {
            const focusableElements = controlsOverlay.querySelectorAll(
              'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            if (e.shiftKey && document.activeElement === firstElement) {
              e.preventDefault();
              lastElement.focus();
            } else if (!e.shiftKey && document.activeElement === lastElement) {
              e.preventDefault();
              firstElement.focus();
            }
          }
        });
      })();
    </script>

    <!-- Main application script -->
    <script type="module">
      async function initializeApp() {
        try {
          // Load Three.js
          const THREE = await import('three');
          window.THREE = THREE;

          // Load OrbitControls
          const { OrbitControls } = await import('three/addons/controls/OrbitControls.js');
          window.OrbitControls = OrbitControls;

          // Load and initialize the main application
          const { StellarDodecahedronViewer } = await import('./script.js');
          const viewer = new StellarDodecahedronViewer();
        } catch (error) {
          console.error('Failed to load application:', error);
          document.body.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        color: white;
                        text-align: center;
                        font-family: Arial;
                    ">
                        <h2>Loading Error</h2>
                        <p>Please refresh the page</p>
                    </div>
                `;
        }
      }

      initializeApp();
    </script>
  </body>
</html>
